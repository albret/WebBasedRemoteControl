use rcdb

drop table users;
drop table sessions;
drop table wsSessions;
drop table resetPassword;
drop table layouts;
drop table comments;
drop table post_votes;
drop table comment_votes;

create table users(
	id INT NOT NULL AUTO_INCREMENT UNIQUE,
	username CHAR(50) UNIQUE,
	email CHAR(100) UNIQUE,
	hash CHAR(64),
	active BOOLEAN NOT NULL DEFAULT 1,
	PRIMARY KEY (id)
);

create table sessions(
    user_id INT NOT NULL UNIQUE,
    token CHAR(128) NOT NULL,
    expire CHAR(13) NOT NULL,
    PRIMARY KEY (token),
    FOREIGN KEY (user_id) REFERENCES users(id)
);

create table wsSessions(
    user_id INT NOT NULL UNIQUE,
    connection_key CHAR(4) NOT NULL,
    expire CHAR(13) NOT NULL,
    PRIMARY KEY (connection_key),
    FOREIGN KEY (user_id) REFERENCES users(id)
);

create table resetPassword(
    user_id INT NOT NULL UNIQUE,
    token CHAR(64) NOT NULL,
    expire CHAR(13) NOT NULL,
    PRIMARY KEY (token),
    FOREIGN KEY (user_id) REFERENCES users(id)
);

create table layouts(
    id INT NOT NULL AUTO_INCREMENT UNIQUE,
    user_id INT NOT NULL UNIQUE,
    data TEXT NOT NULL,
    title CHAR(255),
    text TEXT,
    age CHAR(13),
    active BOOLEAN NOT NULL DEFAULT 0,
    PRIMARY KEY (id),
    FOREIGN KEY (id) REFERENCES layouts(id)
);

create table comments(
    id INT NOT NULL AUTO_INCREMENT UNIQUE,
    user_id INT NOT NULL UNIQUE,
    text TEXT,
    age CHAR(50),
    layout_id INT,
    PRIMARY KEY (id),
    FOREIGN KEY (layout_id) REFERENCES layouts(id)
);

create table post_votes(
    user_id INT NOT NULL UNIQUE,
    layout_id INT NOT NULL UNIQUE,
    vote INT NOT NULL,
    PRIMARY KEY (user_id, layout_id),
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (layout_id) REFERENCES layouts(id)
);

create table comment_votes(
    user_id INT NOT NULL UNIQUE,
    comment_id INT NOT NULL UNIQUE,
    vote INT NOT NULL,
    PRIMARY KEY (user_id, comment_id),
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (comment_id) REFERENCES comments(id)
);

show tables;
